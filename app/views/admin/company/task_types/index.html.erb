<div id="wrapper">
  <%= render 'admin/shared/header' %>
  <div id="page-wrapper" class="gray-bg dashbard-1">
    <%= render '/admin/shared/navbar' %>
    <div class="row wrapper border-bottom white-bg page-heading">
      <div class="col-lg-10">
        <h2>作業区分一覧</h2>
        <ol class="breadcrumb">
          <li>
            <a href="/admin">Home</a>
          </li>
          <li>
            <%= link_to @company.name, admin_companies_path %>
          </li>
          <li class="active">
            <strong>作業区分一覧</strong>
          </li>
        </ol>
      </div>
      <div class="col-lg-2"></div>
    </div>
    
    <div class="wrapper wrapper-content animated fadeInRight">
      <!-- CSVインポートセクション -->
      <div class="row">
        <div class="col-lg-12">
          <div class="ibox float-e-margins">
            <div class="ibox-title">
              <h5><i class="fa fa-upload"></i> CSVインポート</h5>
              <div class="ibox-tools">
                <a class="collapse-link">
                  <i class="fa fa-chevron-up"></i>
                </a>
              </div>
            </div>
            <div class="ibox-content">
              <div class="row">
                <div class="col-lg-8">
                  <%= form_with url: import_admin_company_task_types_path(@company), 
                                local: true, 
                                html: { class: 'form-inline' } do |f| %>
                    <div class="form-group">
                      <%= f.file_field :csv_file, 
                                       class: 'form-control', 
                                       accept: '.csv',
                                       required: true %>
                    </div>
                    <%= f.submit 'インポート実行', 
                                 class: 'btn btn-success',
                                 data: { confirm: 'CSVファイルをインポートしますか？' } %>
                    <span class="help-block m-b-none">
                      <i class="fa fa-info-circle"></i> UTF-8エンコーディングのCSVファイルをアップロードしてください
                    </span>
                  <% end %>
                </div>
                <div class="col-lg-4 text-right">
                  <%= link_to download_template_admin_company_task_types_path(@company), 
                              class: 'btn btn-white btn-sm' do %>
                    <i class="fa fa-download"></i> テンプレートをダウンロード
                  <% end %>
                </div>
              </div>
              
              <!-- インポート手順の説明 -->
              <div class="row m-t-md">
                <div class="col-lg-12">
                  <div class="panel panel-default">
                    <div class="panel-heading">
                      <i class="fa fa-question-circle"></i> インポート手順
                    </div>
                    <div class="panel-body">
                      <ol class="m-b-none">
                        <li>「テンプレートをダウンロード」ボタンからCSVテンプレートをダウンロード</li>
                        <li>テンプレートに作業区分名を入力（1行目はヘッダーです）</li>
                        <li>ファイルを選択して「インポート実行」ボタンをクリック</li>
                        <li>既に登録済みの作業区分名はスキップされます</li>
                      </ol>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 作業区分一覧 -->
      <div class="row">
        <div class="col-lg-12">
          <div class="ibox float-e-margins">
            <div class="ibox-title">
              <h5>作業区分一覧</h5>
              <div class="ibox-tools">
                <%= link_to new_admin_company_task_type_path(@company), 
                            class: 'btn btn-primary btn-xs' do %>
                  <i class="fa fa-plus"></i> 新規登録
                <% end %>
              </div>
            </div>
            <div class="ibox-content">
              <% if @task_types.any? %>
                <div class="table-responsive">
                  <table class="table table-striped table-bordered table-hover">
                    <thead>
                      <tr>
                        <th style="width: 80px;">ID</th>
                        <th>作業区分名</th>
                        <th style="width: 180px;">登録日時</th>
                        <th style="width: 140px;">操作</th>
                      </tr>
                    </thead>
                    <tbody>
                      <% @task_types.each do |task_type| %>
                        <tr>
                          <td class="text-center"><%= task_type.id %></td>
                          <td><%= task_type.name %></td>
                          <td class="text-center">
                            <%= l(task_type.created_at, format: :short) %>
                          </td>
                          <td class="text-center">
                            <%= link_to edit_admin_company_task_type_path(@company, task_type), class: 'btn btn-white btn-sm' do %>
                              <i class="fa fa-pencil"></i> 編集
                            <% end %>
                            <%= link_to admin_company_task_type_path(@company, task_type), class: 'btn btn-danger btn-sm', method: :delete, data: { confirm: '削除しますか？' } do %>
                              <i class="fa fa-trash"></i> 削除
                            <% end %>
                          </td>
                        </tr>
                      <% end %>
                    </tbody>
                  </table>
                </div>
                <%= paginate @task_types, theme: 'admin' %>
              <% else %>
                <div class="text-center p-lg">
                  <i class="fa fa-inbox fa-4x text-muted"></i>
                  <h3 class="m-t-md">作業区分が登録されていません</h3>
                  <p class="text-muted">
                    新規登録またはCSVインポートから作業区分を追加してください
                  </p>
                  <div class="m-t-lg">
                    <%= link_to new_admin_company_task_type_path(@company), 
                                class: 'btn btn-primary' do %>
                      <i class="fa fa-plus"></i> 新規登録
                    <% end %>
                  </div>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="wrapper wrapper-content">
      <%= render 'admin/shared/footer' %>
    </div>
  </div>
</div>